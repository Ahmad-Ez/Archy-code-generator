# Example: Creating a Simple Flask App

This document walks through a brief session with the Archy Co-pilot to create a simple "Hello, World\!" web application using Python and Flask.

The goal is to demonstrate the core `plan -> specify -> code` workflow and showcase features like project management and intelligent dependency file merging.

### Step 0: Start Archy and Select a Project

First, we start the script. It prompts us to select a project or create a new one by providing a path. For this example, we'll provide a path to a new folder.

**You run the script:**

```sh
python archy.py
```

**Archy asks you to choose a project:**

```
[Archy] Select a project or provide a new path.
  1. /path/to/another-project
  ...

Enter a number, a new project path, or 'exit':
```

**You type a path for your new app (use an absolute path):**

```
/path/to/my-flask-app
```

**Archy creates the directory and confirms:**

```
The directory '/path/to/my-flask-app' does not exist. Do you want to create it? (y/N): y
[System] Created project directory: '/path/to/my-flask-app'
[System] Using project directory: '/path/to/my-flask-app'
[System] Started a new project.
Type 'help' for a list of commands, or 'exit' to quit.
```

### Step 1: Plan the Project

Now, inside the running tool, we use the `plan` command to describe our goal.

**You type:**

```
> plan a simple flask app with a single endpoint that returns a json greeting
```

**Archy generates a prompt, you use it with your LLM, and paste back the response. The state is updated, and Archy confirms:**

`[Archy] Project plan created successfully. You can now specify a milestone, e.g., 'specify M1'.`

*(Your `/path/to/my-flask-app/.archy/project_state.json` now contains the plan).*

### Step 2: Specify the Milestone

Next, we follow the suggestion and ask Archy to specify the technical details for the first milestone.

**You type:**

```
> specify M1
```

**After the LLM round-trip, Archy responds:**

`[Archy] Specification for M1 generated. You can now generate code for a task, e.g., 'code M1-T1'.`

*(The `project_state.json` is updated with detailed specifications for the files and logic needed).*

### Step 3: Generate the Code

Now we ask Archy to generate the Python code, the test file, and the `requirements.txt` file.

**You type:**

```
> code M1-T1
```

**After the LLM round-trip, the script processes the AI's response, updates its internal state, and prompts you to write the new files to disk.**

`[Archy] Code for M1-T1 generated.`

```
[System] Project state updated and saved.

[System] The following tasks have new or modified code:
  - M1-T1
Do you want to sync these files to disk now? (y/N):
```

**You type `y`, and Archy saves the files generated by the task.**

```
y
Saving files for M1-T1...
  Saved /path/to/my-flask-app/app.py
  Saved /path/to/my-flask-app/test_app.py
  Saved /path/to/my-flask-app/requirements.txt
[System] Files for M1-T1 saved.
```

### Final Result

After this short session, your project directory now contains a fully functional, testable Flask application and a `requirements.txt` file, all generated from the project state.

**`app.py`:**

```python
# app.py
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/')
def get_greeting():
    """
    Returns a simple JSON greeting.
    """
    try:
        return jsonify({'message': 'Hello, World!'})
    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)
```

**`test_app.py`:**

```python
# test_app.py
import unittest
import json
from app import app

class GreetingAPITestCase(unittest.TestCase):
    def setUp(self):
        self.app = app.test_client()
        self.app.testing = True

    def test_greeting_endpoint_success(self):
        """Test the '/' endpoint for a successful response."""
        response = self.app.get('/')
        self.assertEqual(response.status_code, 200)
        
        data = json.loads(response.get_data(as_text=True))
        self.assertEqual(data['message'], 'Hello, World!')

if __name__ == '__main__':
    unittest.main()
```

**`requirements.txt`:**

```
flask
pytest
```